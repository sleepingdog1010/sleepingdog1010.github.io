<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fukuoka Itinerary Map - November 8-16, 2024</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Custom scrollbar for the sidebar */
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 3px;
        }
        .sidebar-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Leaflet popup customization */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .leaflet-popup-content {
            margin: 1rem !important;
            font-size: 14px;
        }
        .leaflet-popup-tip-container {
            width: 40px;
            height: 20px;
        }
        .leaflet-container a.leaflet-popup-close-button {
            top: 8px;
            right: 8px;
            color: #64748b;
        }
        .leaflet-container a.leaflet-popup-close-button:hover {
            color: #1e293b;
        }
        
        /* Custom marker animation */
        .custom-marker-div {
            transition: transform 0.2s ease-in-out;
        }
        .custom-marker-div:hover {
            transform: scale(1.15);
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="flex flex-col md:flex-row h-screen w-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-full md:w-96 lg:w-[420px] bg-white shadow-lg flex flex-col z-20">
            <!-- Header -->
            <header class="p-6 bg-gradient-to-br from-rose-500 to-orange-500 text-white text-center shadow-md">
                <h1 class="text-2xl font-bold">üáØüáµ Fukuoka Adventure</h1>
                <p class="text-sm font-light opacity-90 mt-1">Your Ultimate Japan Experience</p>
                <div class="mt-4 inline-block bg-white/20 text-xs font-semibold px-4 py-2 rounded-full">
                    üìÖ November 8-16, 2024
                </div>
                 <div class="mt-4 flex justify-center gap-2">
                    <button onclick="showAllDays()" class="px-4 py-2 bg-white/25 hover:bg-white/40 text-white text-xs font-semibold rounded-full transition-colors duration-200 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                        Show All
                    </button>
                    <button onclick="clearRoute()" class="px-4 py-2 bg-white/25 hover:bg-white/40 text-white text-xs font-semibold rounded-full transition-colors duration-200 flex items-center gap-2">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        Clear Route
                    </button>
                </div>
            </header>

            <!-- Itinerary List -->
            <div id="itinerary-container" class="flex-1 overflow-y-auto sidebar-scroll p-3 space-y-3 bg-slate-50">
                <!-- Itinerary day cards will be injected here by JavaScript -->
            </div>
        </aside>

        <!-- Map -->
        <main id="map" class="flex-1 h-full w-full z-10"></main>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        // --- MAP INITIALIZATION ---
        const map = L.map('map').setView([33.5904, 130.4017], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // --- DATA ---
        const homeBase = {
            name: "The B Hakata Hotel",
            lat: 33.5889,
            lng: 130.4170,
            description: "Your home base in Fukuoka - a modern hotel conveniently located near Hakata Station."
        };

        const attractions = [
            // Day 1
            { day: 1, date: "Nov 8 (Arrival)", name: "Tenjin District", lat: 33.5912, lng: 130.3988, category: "Shopping & Entertainment", description: "The vibrant heart of Fukuoka, packed with department stores, boutiques, and restaurants.", icon: "üõçÔ∏è", color: "#34d399", transport: "From Hakata Station, take the Kuko (Airport) Line subway to Tenjin Station (3 stops, 6 mins)." },
            { day: 1, date: "Nov 8 (Arrival)", name: "Yatai Food Stalls", lat: 33.5898, lng: 130.4043, category: "Food & Culture", description: "Iconic open-air food stalls along the river on Nakasu Island. A must-try Fukuoka experience.", icon: "üçú", color: "#fb923c", transport: "From Hakata Station, take the Kuko Line subway to Nakasu-Kawabata Station (2 stops, 4 mins)." },
            // Day 2
            { day: 2, date: "Nov 9", name: "Fukuoka Castle Ruins", lat: 33.5855, lng: 130.3823, category: "Historical Sites", description: "Explore the stone walls and foundations of the once-largest castle in Kyushu, located in Maizuru Park.", icon: "üèØ", color: "#f87171", transport: "From Hakata Station, take the Kuko Line subway to Ohorikoen Station (4 stops, 8 mins), then a 10-min walk." },
            { day: 2, date: "Nov 9", name: "Ohori Park", lat: 33.5850, lng: 130.3750, category: "Nature & Parks", description: "A beautiful urban park centered around a large pond, with walking paths and a traditional Japanese garden.", icon: "üå∏", color: "#60a5fa", transport: "From Hakata Station, take the Kuko Line subway to Ohorikoen Station (4 stops, 8 mins)." },
            // Day 3
            { day: 3, date: "Nov 10", name: "Fukuoka Tower", lat: 33.5934, lng: 130.3515, category: "Landmarks", description: "Japan's tallest seaside tower, offering breathtaking 360-degree views of the city and Hakata Bay.", icon: "üóº", color: "#c084fc", transport: "From Hakata Bus Terminal, take Nishitetsu Bus #306 to Fukuoka Tower (approx. 25 mins)." },
            { day: 3, date: "Nov 10", name: "Momochihama Beach", lat: 33.5955, lng: 130.3505, category: "Nature & Parks", description: "A modern artificial beach right by Fukuoka Tower, with shops and restaurants at Marizon.", icon: "üèñÔ∏è", color: "#60a5fa", transport: "A 2-minute walk from Fukuoka Tower." },
            // Day 4
            { day: 4, date: "Nov 11", name: "Dazaifu Tenmangu Shrine", lat: 33.5213, lng: 130.5352, category: "Historical Sites", description: "One of Japan's most important Tenmangu shrines, dedicated to the god of learning, Sugawara no Michizane.", icon: "‚õ©Ô∏è", color: "#f87171", transport: "From Hakata Bus Terminal, take the direct Dazaifu Liner Bus 'Tabito' (approx. 40 mins)." },
            { day: 4, date: "Nov 11", name: "K≈çmy≈çzen-ji Temple", lat: 33.5204, lng: 130.5350, category: "Historical Sites", description: "A serene Zen temple famous for its beautiful 'koke-dera' (moss garden) and stone gardens.", icon: "üåø", color: "#f87171", transport: "A 5-minute walk from Dazaifu Tenmangu Shrine." },
            // Day 5
            { day: 5, date: "Nov 12", name: "Canal City Hakata", lat: 33.5895, lng: 130.4108, category: "Shopping & Entertainment", description: "A massive, unique shopping and entertainment complex with a canal running through its center.", icon: "üèÆ", color: "#34d399", transport: "A pleasant 10-15 minute walk from Hakata Station." },
            { day: 5, date: "Nov 12", name: "Kushida Shrine", lat: 33.5935, lng: 130.4111, category: "Historical Sites", description: "Regarded as the guardian shrine of Hakata, it's the host of the famous Hakata Gion Yamakasa festival.", icon: "‚õ©Ô∏è", color: "#f87171", transport: "A short walk from Canal City Hakata, or from Gion subway station." },
            // Day 6
            { day: 6, date: "Nov 13", name: "Yanagawa River Punting", lat: 33.1650, lng: 130.4050, category: "Food & Culture", description: "A relaxing day trip to the 'Venice of Kyushu'. Enjoy a leisurely boat ride along the scenic canals.", icon: "üõ∂", color: "#fb923c", transport: "From Nishitetsu Fukuoka (Tenjin) Station, take the Limited Express train to Nishitetsu-Yanagawa (approx. 50 mins)." },
            // Day 7
            { day: 7, date: "Nov 14", name: "Nokonoshima Island", lat: 33.6135, lng: 130.3235, category: "Nature & Parks", description: "A beautiful island in Hakata Bay known for its seasonal flower fields. Requires a ferry trip.", icon: "üèùÔ∏è", color: "#60a5fa", transport: "From Hakata St, take a bus to Noko Tosenba (Ferry Terminal), then a 10-min ferry ride." },
            { day: 7, date: "Nov 14", name: "Nakasu Nightlife", lat: 33.5908, lng: 130.4065, category: "Shopping & Entertainment", description: "Fukuoka's premier entertainment district, located on an island between two rivers, full of restaurants and bars.", icon: "üçª", color: "#34d399", transport: "Accessible via Nakasu-Kawabata subway station." },
            // Day 8
            { day: 8, date: "Nov 15", name: "Kawabata Shopping Arcade", lat: 33.5925, lng: 130.4090, category: "Shopping & Entertainment", description: "Hakata's oldest covered shopping street, perfect for finding traditional souvenirs and local goods.", icon: "üéÅ", color: "#34d399", transport: "Connected to the Nakasu-Kawabata subway station." },
            { day: 8, date: "Nov 15", name: "Manyo-no-Yu Onsen", lat: 33.5800, lng: 130.4380, category: "Food & Culture", description: "A large, modern hot spring complex offering a variety of baths and relaxation facilities.", icon: "‚ô®Ô∏è", color: "#fb923c", transport: "A free shuttle bus is available from Hakata Station." },
            // Day 9
            { day: 9, date: "Nov 16 (Departure)", name: "Fukuoka Airport (FUK)", lat: 33.5789, lng: 130.4494, category: "Transportation", description: "Time to head home after an amazing trip!", icon: "‚úàÔ∏è", color: "#94a3b8", transport: "From Hakata Station, take the Kuko Line subway directly to the airport (2 stops, 5 mins)." }
        ];

        // --- GLOBAL STATE ---
        let allMarkers = [];
        let routingLayer = null;

        // --- UI RENDERING ---
        function renderItinerary() {
            const container = document.getElementById('itinerary-container');
            container.innerHTML = ''; // Clear existing content
            const days = [...new Set(attractions.map(a => a.day))];

            days.forEach(dayNum => {
                const dayAttractions = attractions.filter(a => a.day === dayNum);
                const dayDate = dayAttractions[0].date;

                const dayCard = document.createElement('div');
                dayCard.className = 'bg-white rounded-xl shadow-sm border border-slate-200/80 overflow-hidden';
                dayCard.innerHTML = `
                    <div class="day-header p-4 bg-slate-100 border-b border-slate-200/80 cursor-pointer hover:bg-slate-200 transition-colors" onclick="filterByDay(${dayNum})">
                        <h2 class="font-bold text-slate-800">Day ${dayNum} <span class="font-normal text-slate-500 text-sm ml-2">${dayDate}</span></h2>
                    </div>
                    <div class="day-attractions p-2 space-y-1">
                        ${dayAttractions.map(attraction => `
                            <div class="attraction-item flex items-center p-3 rounded-lg cursor-pointer hover:bg-sky-50 transition-colors" onclick="focusOnAttraction(${attraction.lat}, ${attraction.lng})">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-xl" style="background-color: ${attraction.color}20;">
                                    ${attraction.icon}
                                </div>
                                <div class="ml-4 flex-1">
                                    <h3 class="font-semibold text-sm text-slate-700">${attraction.name}</h3>
                                    <p class="text-xs text-slate-500">${attraction.category}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(dayCard);
            });
        }

        // --- MARKER & POPUP CREATION ---
        function createCustomIcon(emoji, color) {
            return L.divIcon({
                className: 'custom-marker',
                html: `<div class="custom-marker-div w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg border-2 border-white" style="background-color: ${color};">${emoji}</div>`,
                iconSize: [40, 40],
                iconAnchor: [20, 40],
                popupAnchor: [0, -40]
            });
        }

        function createPopupContent(attraction) {
            return `
                <div class="w-64">
                    <h3 class="text-base font-bold text-slate-800">${attraction.icon} ${attraction.name}</h3>
                    <p class="text-xs font-semibold uppercase tracking-wider text-white px-2 py-0.5 rounded-full inline-block my-2" style="background-color: ${attraction.color};">${attraction.category}</p>
                    <p class="text-sm text-slate-600 my-2">${attraction.description}</p>
                    <div class="mt-3 pt-3 border-t border-slate-200">
                        <p class="text-xs font-semibold text-slate-700">üöä Transport:</p>
                        <p class="text-xs text-slate-500">${attraction.transport}</p>
                    </div>
                </div>
            `;
        }
        
        function addMarkersToMap() {
            // Add Home Base Marker
            const homeIcon = createCustomIcon('üè®', '#ef4444');
            const homeMarker = L.marker([homeBase.lat, homeBase.lng], { icon: homeIcon, zIndexOffset: 1000 }).addTo(map);
            homeMarker.bindPopup(`
                <div class="w-64">
                    <h3 class="text-base font-bold text-slate-800">üè® ${homeBase.name}</h3>
                    <p class="text-sm text-slate-600 my-2">${homeBase.description}</p>
                    <p class="text-xs font-semibold uppercase text-rose-500">Your Home Base</p>
                </div>
            `);

            // Add Attraction Markers
            attractions.forEach(attraction => {
                const icon = createCustomIcon(attraction.icon, attraction.color);
                const marker = L.marker([attraction.lat, attraction.lng], { icon });
                marker.attractionData = attraction;
                marker.bindPopup(createPopupContent(attraction));
                marker.on('click', () => showRouteToAttraction(attraction));
                allMarkers.push(marker);
            });
            showAllDays(); // Initially show all markers
        }

        // --- ROUTING & FILTERING LOGIC ---
        function clearRoute() {
            if (routingLayer) {
                map.removeLayer(routingLayer);
                routingLayer = null;
            }
        }

        function showRouteToAttraction(attraction) {
            clearRoute();
            routingLayer = L.layerGroup();

            const routeLine = L.polyline([
                [homeBase.lat, homeBase.lng],
                [attraction.lat, attraction.lng]
            ], {
                color: attraction.color,
                weight: 5,
                opacity: 0.7,
                dashArray: '8, 8'
            });
            
            routingLayer.addLayer(routeLine);
            routingLayer.addTo(map);

            const bounds = L.latLngBounds([
                [homeBase.lat, homeBase.lng],
                [attraction.lat, attraction.lng]
            ]);
            map.fitBounds(bounds, { padding: [50, 50], maxZoom: 15 });
        }

        window.filterByDay = (day) => {
            clearRoute();
            map.closePopup();
            
            document.querySelectorAll('.day-header').forEach(h => h.classList.remove('bg-sky-200'));
            const activeHeader = document.querySelector(`[onclick="filterByDay(${day})"]`);
            if(activeHeader) activeHeader.classList.add('bg-sky-200');

            const dayAttractions = [];
            allMarkers.forEach(marker => {
                if (marker.attractionData.day === day) {
                    if (!map.hasLayer(marker)) marker.addTo(map);
                    dayAttractions.push(marker.getLatLng());
                } else {
                    if (map.hasLayer(marker)) map.removeLayer(marker);
                }
            });

            if (dayAttractions.length > 0) {
                dayAttractions.push([homeBase.lat, homeBase.lng]); // include home
                const bounds = L.latLngBounds(dayAttractions);
                map.fitBounds(bounds, { padding: [40, 40] });
            }
        }

        window.showAllDays = () => {
            clearRoute();
            map.closePopup();
            document.querySelectorAll('.day-header').forEach(h => h.classList.remove('bg-sky-200'));

            allMarkers.forEach(marker => {
                if (!map.hasLayer(marker)) {
                    marker.addTo(map);
                }
            });
            map.setView([33.5904, 130.4017], 12);
        }
        
        window.focusOnAttraction = (lat, lng) => {
            const targetMarker = allMarkers.find(m => m.getLatLng().lat === lat && m.getLatLng().lng === lng);
            if (targetMarker) {
                map.setView([lat, lng], 16, { animate: true });
                targetMarker.openPopup();
                showRouteToAttraction(targetMarker.attractionData);
            }
        }

        // --- INITIALIZE APP ---
        document.addEventListener('DOMContentLoaded', () => {
            renderItinerary();
            addMarkersToMap();
        });

    </script>
</body>
</html>
